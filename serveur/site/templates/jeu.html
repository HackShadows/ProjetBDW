<!--
Contributeur 1 : BOULLOT Matthias p2306662
Contributeur 2 : CISERANE Marius p2303380
-->

{% extends "base.html" %}

{% block main_content %}





{% if 'partie_en_cours' not in SESSION %}

<div class="warning">
	<h2>Vous n'avez pas sélectionné de partie !</h2>
	<p>Veuillez retourner à la page des parties pour en sélectionner une.<br>(Comment êtes-vous arrivés ici ?)</p>
	<a href="/parties" class="redirection">Parties : Choisir une partie</a>
</div>





{% else %}

{% if REQUEST_VARS['phase'] == 'resultats' %}
<p>Félicitation, vous avez fait un score de {{ REQUEST_VARS['score'] }}</p>
<p>Vous êtes classé {{ REQUEST_VARS['rang'][0] }}e sur {{ REQUEST_VARS['rang'][1] }} !</p>
<p>{% if REQUEST_VARS['score'] == 0 %}??? attendez je crois que j'ai mal lu...{% endif %}</p>
{% endif %}

<form id="jeu" action="/jeu" method="POST">

	{% if REQUEST_VARS['phase'] != 'resultats' %}
	<a href="/" title="Arrêter temporairement la partie">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
			<path fill="#000000" d="M4.4 7.4L6.8 4h2.5L7.2 7h6.3a6.5 6.5 0 0 1 0 13H9l1-2h3.5a4.5 4.5 0 1 0 0-9H7.2l2.1 3H6.8L4.4 8.6L4 8z"/>
		</svg>
	</a>
	{% endif %}

	<table>
		<tr>
			<th></th>
			{% for x in range(1,REQUEST_VARS['taille_grille']+1) %}
			<th class="{% if REQUEST_VARS['phase'] == 'resultats' %}{% if REQUEST_VARS['resultat_grille']['ligne'][x-1] == 0 %}contrainte_perdu{% else %}contrainte_valide{% endif %}{% else %}contrainte_defaut{% endif %}"><img src="site/static/img/tuiles/{{ REQUEST_VARS['grille'][0][x] }}"></th>
			{% endfor %}
			<th></th>
		</tr>
		{% for y in range(1,REQUEST_VARS['taille_grille']+1) %}
		<tr>
			<th class="{% if REQUEST_VARS['phase'] == 'resultats' %}{% if REQUEST_VARS['resultat_grille']['colonne'][y-1] == 0 %}contrainte_perdu{% else %}contrainte_valide{% endif %}{% else %}contrainte_defaut{% endif %}"><img src="site/static/img/tuiles/{{ REQUEST_VARS['grille'][y][0] }}"></th>
			{% for x in range(1,REQUEST_VARS['taille_grille']+1) %}
			<td>
				{% if REQUEST_VARS['phase'] == 'joue_carte' %}
				{% if REQUEST_VARS['grille'][y][x] is none %}
				<input type="radio" name="emplacement" value="{{ x }},{{ y }}" required>
				<div class="tuile-emplacement"></div>
				{% else %}
				<button type="button"></button>
				<img src="site/static/img/tuiles/{{ REQUEST_VARS['grille'][y][x] }}">
				{% endif %}
				{% else %}
				{% if REQUEST_VARS['grille'][y][x] is none %}
				<div class="tuile-emplacement"></div>
				{% else %}
				<img src="site/static/img/tuiles/{{ REQUEST_VARS['grille'][y][x] }}">
				{% endif %}
				{% endif %}
			</td>
			{% endfor %}
			{% if REQUEST_VARS['phase'] == 'resultats' %}
			<td class="{% if REQUEST_VARS['resultat_grille']['colonne'][y-1] == 0 %}tuile-score-nul{% else %}tuile-score-bien{% endif %}">+ {{ REQUEST_VARS['resultat_grille']['colonne'][y-1] }}</td>
			{% else %}
			<td></td>
			{% endif %}
		</tr>
		{% endfor %}
		<tr>
			<th></th>
			{% if REQUEST_VARS['phase'] == 'resultats' %}
			{% for x in range(REQUEST_VARS['taille_grille']) %}
			<td class="{% if REQUEST_VARS['resultat_grille']['ligne'][x] == 0 %}tuile-score-nul{% else %}tuile-score-bien{% endif %}">+ {{ REQUEST_VARS['resultat_grille']['ligne'][x] }}</td>
			{% endfor %}
			<td>= {{ REQUEST_VARS['score'] }}</td>
			{% else %}
			{% for x in range(REQUEST_VARS['taille_grille']) %}
			<td></td>
			{% endfor %}
			<td></td>
			{% endif %}
		</tr>
	</table>

	{% if REQUEST_VARS['phase'] != 'resultats' %}
	<label>
		Valider
		<input type=submit>
	</label>
	{% endif %}


	<ul>
		{% for tuile in REQUEST_VARS['pioche'] %}
		<li>
			{% if tuile is not none %}
			<input type="radio" name="choisie" value="{{ loop.index }}" required>
			<img src="site/static/img/tuiles/{{ tuile }}">
			{% else %}
			<div class="tuile-emplacement"></div>
			{% endif %}
		</li>
		{% endfor %}
	</ul>


</form>





{% endif %}

{% endblock %}
